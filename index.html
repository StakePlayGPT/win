<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Stake Play</title>

  <!-- PWA -->
  <link rel="manifest" href="/win/manifest.json">
  <meta name="theme-color" content="#000000">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/win/sw.js').catch(console.error);
    }
  </script>

  <style>
    :root { --bg:#0b0b0c; --card:#131316; --line:#23232a; --fg:#fff; --muted:#9aa0a6; --accent:#22c55e; }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    .wrap{padding:24px; width:min(560px,100%)}
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:16px; padding:24px;
      text-align:center; box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    h1{margin:0 0 8px;font-size:28px}
    p{margin:0 0 0;color:var(--muted)}

    /* –û–±—â–∏–π –±–∞–Ω–Ω–µ—Ä A2HS */
    .a2hs{
      position:fixed; left:12px; right:12px; bottom:12px; z-index:50;
      background:#15151a; border:1px solid var(--line); color:var(--fg); border-radius:16px;
      padding:14px; display:none; box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .a2hs.visible{display:block}
    .a2hs .title{font-weight:800; margin:0 0 6px}
    .a2hs .steps{color:#d9d9de; font-size:14px; line-height:1.5}
    .a2hs .actions{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap}
    .a2hs button,.a2hs a{
      padding:10px 12px; border-radius:10px; border:1px solid #2a2a31;
      background:#1b1b20; color:#fff; cursor:pointer; text-decoration:none; font-weight:700
    }
    .a2hs .ok{background:var(--accent); color:#0b0b0c; border-color:#149a49}
    .a2hs .ghost{background:#25252b}

    /* –ë–∞–Ω–Ω–µ—Ä –¥–ª—è Instagram WebView */
    .igbar{ composes: a2hs; } /* –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏; –µ—Å–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–∏–∂–µ –¥—É–±–ª—å */
    .igbar{
      position:fixed; left:12px; right:12px; bottom:12px; z-index:60;
      background:#15151a; border:1px solid var(--line); color:#fff; border-radius:16px;
      padding:14px; display:none; box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .igbar.visible{display:block}
    .igbar .title{font-weight:800; margin:0 0 6px}
    .igbar .steps{color:#d9d9de; font-size:14px; line-height:1.5; white-space:normal; word-break:normal}
    .igbar .actions{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap}
    .igbar .btn{padding:10px 12px; border-radius:10px; border:1px solid #2a2a31;
                background:#1b1b20; color:#fff; cursor:pointer; text-decoration:none; font-weight:700}
    .igbar .btn-primary{background:#22c55e; color:#0b0b0c; border-color:#149a49}
    .igbar .btn-ghost{background:#25252b}
    @media (max-width: 420px){
      .a2hs .actions, .igbar .actions{flex-direction:column; align-items:stretch}
    }
    .icon-share{display:inline-block; width:14px; height:14px; border:2px solid currentColor; border-radius:3px; position:relative; top:2px; margin:0 3px}
    .icon-share::after{content:"‚Üë"; position:absolute; left:2px; top:-8px; font-weight:700; font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Stake Play</h1>
      <p>Accesso rapido ai segnali e ai giochi üéÆ</p>
    </div>
  </div>

  <!-- –ë–∞–Ω–Ω–µ—Ä A2HS (iOS/Android –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤) -->
  <div id="a2hs" class="a2hs" role="region" aria-live="polite">
    <div class="title" id="a2hs-title"></div>
    <div class="steps" id="a2hs-steps"></div>
    <div class="actions">
      <button id="a2hs-install" class="ok" style="display:none">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
      <button id="a2hs-close" class="ghost">–°–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ë–∞–Ω–Ω–µ—Ä –¥–ª—è Instagram WebView -->
  <div id="igbar" class="igbar" role="region" aria-live="polite">
    <div class="title">–í—ã –æ—Ç–∫—Ä—ã–ª–∏ —Å–∞–π—Ç –≤–Ω—É—Ç—Ä–∏ Instagram</div>
    <div id="ig-steps" class="steps"></div>
    <div class="actions">
      <a id="ig-open" class="btn btn-primary" href="#">–û—Ç–∫—Ä—ã—Ç—å –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</a>
      <button id="ig-share" class="btn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è‚Ä¶</button>
      <button id="ig-copy"  class="btn btn-ghost">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      <button id="ig-close" class="btn btn-ghost">–°–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script>
    (function(){
      const ua = navigator.userAgent.toLowerCase();
      const isIOS = /iphone|ipad|ipod/.test(ua);
      const isAndroid = /android/.test(ua);
      const isIG = ua.includes('instagram');
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches || navigator.standalone === true;

      /* ---------- –û–±—ã—á–Ω—ã–π A2HS –±–∞–Ω–Ω–µ—Ä (–Ω–µ –¥–ª—è Instagram) ---------- */
      const a2hs = document.getElementById('a2hs');
      const a2hsTitle = document.getElementById('a2hs-title');
      const a2hsSteps = document.getElementById('a2hs-steps');
      const btnInstall = document.getElementById('a2hs-install');
      const btnClose = document.getElementById('a2hs-close');

      const KEY = 'a2hs_dismissed_v1';
      if (!localStorage.getItem(KEY) && !isStandalone && !isIG) {
        let deferredPrompt = null;

        if (isIOS) {
          a2hsTitle.textContent = '–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (iPhone)';
          a2hsSteps.innerHTML = `
            1) –ù–∞–∂–º–∏ <span class="icon-share" aria-hidden="true"></span> <b>¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª</b> –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞.<br>
            2) –í—ã–±–µ—Ä–∏ <b>¬´–ù–∞ —ç–∫—Ä–∞–Ω ‚Äú–î–æ–º–æ–π‚Äù¬ª</b> ‚Üí <b>–î–æ–±–∞–≤–∏—Ç—å</b>.
          `;
          a2hs.classList.add('visible');
        }

        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          if (!isAndroid) return;
          deferredPrompt = e;
          a2hsTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (Android)';
          a2hsSteps.innerHTML = `
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É <b>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</b> –Ω–∏–∂–µ.<br>
            –ï—Å–ª–∏ –±–∞–Ω–Ω–µ—Ä –Ω–µ –ø–æ—è–≤–∏–ª—Å—è: –º–µ–Ω—é <b>‚ãÆ</b> ‚Üí <b>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</b>.
          `;
          btnInstall.style.display = 'inline-block';
          a2hs.classList.add('visible');
        });

        btnInstall.addEventListener('click', async () => {
          if (!deferredPrompt) return;
          deferredPrompt.prompt();
          try { await deferredPrompt.userChoice; } catch(_) {}
          deferredPrompt = null;
          a2hs.classList.remove('visible');
          localStorage.setItem(KEY, '1');
        });

        btnClose.addEventListener('click', () => {
          a2hs.classList.remove('visible');
          localStorage.setItem(KEY, '1');
        });

        window.addEventListener('appinstalled', () => {
          a2hs.classList.remove('visible');
          localStorage.setItem(KEY, '1');
        });
      }

      /* ---------- –ë–∞–Ω–Ω–µ—Ä –¥–ª—è Instagram WebView ---------- */
      if (isIG && !isStandalone) {
        const bar = document.getElementById('igbar');
        const steps = document.getElementById('ig-steps');
        const btnOpen  = document.getElementById('ig-open');
        const btnShare = document.getElementById('ig-share');
        const btnCopy  = document.getElementById('ig-copy');
        const btnCloseIG = document.getElementById('ig-close');
        const URL_NOW  = location.href.split('#')[0];

        if (isIOS) {
          steps.innerHTML = `–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω, –æ—Ç–∫—Ä–æ–π –≤ Safari:<br>
            –ù–∞–∂–º–∏ <b>‚Ä¶</b> –≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞ ‚Üí <b>Open in System Browser</b>.<br>
            –í Safari: <b>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</b> ‚Üí <b>–ù–∞ —ç–∫—Ä–∞–Ω ‚Äú–î–æ–º–æ–π‚Äù</b> ‚Üí <b>–î–æ–±–∞–≤–∏—Ç—å</b>.`;
          btnOpen.href = URL_NOW; // –∞–≤—Ç–æ-–æ—Ç–∫—Ä—ã—Ç—å Safari –Ω–µ–ª—å–∑—è
        } else {
          steps.innerHTML = `–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω, –æ—Ç–∫—Ä–æ–π –≤ Chrome:<br>
            –ú–µ–Ω—é <b>‚ãÆ</b> ‚Üí <b>–û—Ç–∫—Ä—ã—Ç—å –≤ Chrome</b> (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ).<br>
            –í Chrome: <b>‚ãÆ</b> ‚Üí <b>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</b> / <b>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</b>.`;
          const intent = `intent://${location.host}${location.pathname}${location.search}#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=${encodeURIComponent(URL_NOW)};end`;
          btnOpen.addEventListener('click', (e)=>{ e.preventDefault(); location.href = intent; });
        }

        btnShare.addEventListener('click', async ()=>{
          const data = { title: document.title, text: '–û—Ç–∫—Ä–æ–π –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ', url: URL_NOW };
          if (navigator.share) { try { await navigator.share(data); return; } catch(e){} }
          try { await navigator.clipboard.writeText(URL_NOW); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞. –û—Ç–∫—Ä–æ–π –µ—ë –≤ Chrome/Safari.'); }
          catch { prompt('–°–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é:', URL_NOW); }
        });

        btnCopy.addEventListener('click', async ()=>{
          try { await navigator.clipboard.writeText(URL_NOW); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞. –û—Ç–∫—Ä–æ–π –µ—ë –≤ Chrome/Safari.'); }
          catch { prompt('–°–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é:', URL_NOW); }
        });

        btnCloseIG.addEventListener('click', ()=> bar.remove());
        bar.classList.add('visible');
      }
    })();
  </script>
</body>
</html>
